package udacity.pedrovarela.com.mypopulasmovies;import android.app.Fragment;import android.net.Uri;import android.os.AsyncTask;import android.os.Bundle;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.GridView;import com.google.gson.Gson;import com.google.gson.reflect.TypeToken;import java.io.BufferedReader;import java.io.IOException;import java.io.InputStream;import java.io.InputStreamReader;import java.lang.reflect.Type;import java.net.HttpURLConnection;import java.net.URL;import java.util.ArrayList;import java.util.List;import udacity.pedrovarela.com.mypopulasmovies.adapter.MoviesAdapter;import udacity.pedrovarela.com.mypopulasmovies.core.Movie;import udacity.pedrovarela.com.mypopulasmovies.core.SearchResult;/** * A placeholder fragment containing a simple view. */public class MainActivityFragment extends Fragment {    private GridView gridViewPopularMovies;    private final String TAG = MainActivityFragment.class.getName();    private final Type typeSearchResult = new TypeToken<SearchResult>() {    }.getType();    private MoviesAdapter moviesAdapter;    private  List<Movie> movieList;    public MainActivityFragment() {    }    @Override    public void onCreate(Bundle savedInstanceState) {        setHasOptionsMenu(false);        super.onCreate(savedInstanceState);    }    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container,                             Bundle savedInstanceState) {        return inflater.inflate(R.layout.fragment_main, container, false);    }    /**     * On view created method     * @param view View created     * @param savedInstanceState Saved instance state     */    @Override    public void onViewCreated(View view, Bundle savedInstanceState) {        super.onViewCreated(view, savedInstanceState);        gridViewPopularMovies = (GridView) view.findViewById(R.id.gridViewPopularMovies);        movieList = new ArrayList<>();        moviesAdapter = new MoviesAdapter(getActivity(),movieList);        gridViewPopularMovies.setAdapter(moviesAdapter);        new FetchMoviesTask().execute();    }    /**     * AsyncTask class to fetch movies from database     */    private class FetchMoviesTask extends AsyncTask<Void, Void, SearchResult> {        @Override        protected SearchResult doInBackground(Void... params) {            HttpURLConnection urlConnection = null;            BufferedReader reader = null;            String moviesJsonString = null;            SearchResult searchResult;            String base_url = "http://api.themoviedb.org/3/discover/movie";            try {                Uri builtUri = Uri.parse(base_url).buildUpon().appendQueryParameter("api_key", "9207151e0751c013d2d36ff02d6cab7a")                        .appendQueryParameter("sort_by","popularity.desc").build();                URL url = new URL(builtUri.toString());                urlConnection = (HttpURLConnection) url.openConnection();                urlConnection.setRequestMethod("GET");                urlConnection.connect();                // Read the input stream into a String                InputStream inputStream = urlConnection.getInputStream();                StringBuilder buffer = new StringBuilder();                if (inputStream == null) {                    return null;                }                reader = new BufferedReader(new InputStreamReader(inputStream));                String line;                while ((line = reader.readLine()) != null) {                    buffer.append(line).append("\n");                }                if (buffer.length() == 0) {                    return null;                }                moviesJsonString = buffer.toString();            } catch (IOException e) {                Log.e(TAG, "Error ", e);                return null;            } finally {                if (urlConnection != null) {                    urlConnection.disconnect();                }                if (reader != null) {                    try {                        reader.close();                    } catch (final IOException e) {                        Log.e(TAG, "Error closing stream", e);                    }                }            }            Gson gson = new Gson();            searchResult = gson.fromJson(moviesJsonString, typeSearchResult);            return searchResult;        }        /**         *         * @param searchResult Search result         */        @Override        protected void onPostExecute(SearchResult searchResult) {            moviesAdapter.addAll(searchResult.getResults());        }    }}